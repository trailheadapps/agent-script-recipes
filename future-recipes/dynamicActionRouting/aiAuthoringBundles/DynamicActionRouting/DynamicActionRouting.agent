# DynamicActionRouting - Conditional Action Availability
# This agent demonstrates how to show/hide actions based on context using 'available when'
system:
   instructions: "You are a support ticket management assistant. Route actions based on context and permissions."

   messages:
       welcome: "Welcome to support! I'll help you manage tickets efficiently."
       error: "Unable to process that action. Please check permissions and ticket status."

config:
   agent_name: "DynamicActionRouting"
   agent_label: "DynamicActionRouting"
   agent_type: "AgentforceEmployeeAgent"
   description: "Routes support tickets with context-aware action availability"

variables:
   ticket_id: mutable string = ""
       description: "Current support ticket/case ID"
   ticket_number: mutable string = ""
       description: "Current support ticket number or the case number"
   ticket_status: mutable string = ""
       description: "Ticket status: new, assigned, in_progress, resolved, closed"
   ticket_priority: mutable string = ""
       description: "Priority: low, medium, high, urgent"
   user_role: mutable string = "agent"
       description: "User role: agent, supervisor, admin"
   assigned_to: mutable string = ""
       description: "Agent assigned to this ticket"
   requires_escalation: mutable boolean = False
       description: "Whether ticket needs supervisor escalation"

start_agent topic_selector:
   description: "Welcome users and begin managing support tickets"

   reasoning:
    instructions:|
        Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
       actions:
           manage_tickets: @utils.transition to @topic.ticket_management

topic ticket_management:
   description: "Manages support tickets with context-aware actions. Available actions depend on ticket status, priority level, and your role/permissions. Let me know which ticket you'd like to work with."

   reasoning:
       instructions: ->
           | Ticket Management

           if @variables.ticket_number:
               | Ticket: {!@variables.ticket_number}
           else:
               | Ticket: None
           if @variables.ticket_status:
               | Status: {!@variables.ticket_status}
           else:
               | Status: N/A
           if @variables.ticket_priority:
               | Priority: {!@variables.ticket_priority}
           else:
               | Priority: N/A

           | Your role: {!@variables.user_role}

           if @variables.assigned_to:
               | Assigned to: {!@variables.assigned_to}
           else:
               | Assigned to: Unassigned

           | Available actions depend on:
             - Ticket status
             - Priority level
             - Your role/permissions
             - Current assignment
 
             Guide the user through available ticket operations.

       actions:
           view_ticket: @actions.view_ticket
               with ticket_number = ...
               set  @variables.ticket_id = @outputs.ticket_info.data.Id

           add_comment: @actions.add_comment
               with ticket_id = @variables.ticket_id
               with comment = ...

           assign_ticket: @actions.assign_ticket
               available when @variables.ticket_status == "new"
               with ticket_id = @variables.ticket_id
               with name = ...

           update_status: @actions.update_status
               available when @variables.ticket_status == "assigned" or @variables.ticket_status == "in_progress"
               with ticket_id = @variables.ticket_id
               with new_status = ...

           close_ticket: @actions.close_ticket
               available when @variables.ticket_status == "resolved"
               with ticket_id = @variables.ticket_id

           escalate_ticket: @actions.escalate_ticket
               available when @variables.ticket_priority == "high" or @variables.ticket_priority == "urgent"
               with ticket_id = @variables.ticket_id
               with reason = ...

           reassign_ticket: @actions.reassign_ticket
               available when @variables.user_role == "supervisor" or @variables.user_role == "admin"
               with ticket_id = @variables.ticket_id
               with new_agent = ...

           delete_ticket: @actions.delete_ticket
               available when @variables.user_role == "admin"
               with ticket_id = @variables.ticket_id
   actions:
       view_ticket:
           description: "Views ticket details"
           inputs:
               ticket_number: string
                   description: "The unique identifier of the ticket/case to view"
           outputs:
               ticket_info: object
                   description: "Complete ticket information including status, priority, description, and history"
           target: "flow://ViewTicket"

       add_comment:
           description: "Adds a comment to the ticket"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the ticket to add a comment to"
               comment: string
                   description: "The comment text to add to the ticket"
           outputs:
               success: boolean
                   description: "Indicates whether the comment was added successfully"
           target: "flow://AddTicketComment"

       assign_ticket:
           description: "Assigns ticket to an agent"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the ticket to assign"
               agent: string
                   description: "The name or ID of the agent to assign the ticket to"
           outputs:
               success: boolean
                   description: "Indicates whether the ticket was assigned successfully"
           target: "flow://AssignTicket"

       update_status:
           description: "Updates ticket status"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the ticket to update"
               new_status: string
                   description: "New status to set (assigned, in_progress, resolved, closed)"
           outputs:
               success: boolean
                   description: "Indicates whether the status was updated successfully"
           target: "flow://UpdateTicketStatus"

       close_ticket:
           description: "Closes a resolved ticket"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the resolved ticket to close"
           outputs:
               success: boolean
                   description: "Indicates whether the ticket was closed successfully"
           target: "flow://CloseTicket"

       escalate_ticket:
           description: "Escalates ticket to supervisor"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the ticket to escalate"
               reason: string
                   description: "Reason for escalation (e.g., complexity, urgency, customer request)"
           outputs:
               success: boolean
                   description: "Indicates whether the ticket was escalated successfully"
           target: "flow://EscalateTicket"

       delete_ticket:
           description: "Permanently deletes a ticket"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the ticket to permanently delete"
           outputs:
               success: boolean
                   description: "Indicates whether the ticket was deleted successfully"
           target: "flow://DeleteTicket"

       reassign_ticket:
           description: "Reassigns ticket to different agent"
           inputs:
               ticket_id: string
                   description: "The unique identifier of the ticket to reassign"
               new_agent: string
                   description: "The name or ID of the agent to reassign the ticket to"
           outputs:
               success: boolean
                   description: "Indicates whether the ticket was reassigned successfully"
           target: "flow://ReassignTicket"


# TemplateExpressions - Dynamic Content with Template Syntax
# This agent demonstrates how to use template expressions to create dynamic, personalized responses

config:
   agent_name: "TemplateExpressions"
   agent_label: "TemplateExpressions"
   agent_type: "AgentforceEmployeeAgent"
   description: "Personalized shopping assistant using template expressions for dynamic content"

variables:
   customer_name: mutable string = ""
      description: "The customer's name"

   budget: mutable number = 0
      description: "Customer's shopping budget"

   cart_items: mutable list[string] = []
      description: "Items currently in the shopping cart"

   cart_total: mutable number = 0
      description: "Total cost of items in cart"

   loyalty_points: mutable number = 0
      description: "Customer's loyalty reward points"

system:
   messages:
      welcome: "Welcome to our store! I'm your personal shopping assistant."
      error: "Oops! Something went wrong. Let me try that again."
 
   # Template expressions work in system instructions too
   # Use {!expression} syntax to insert dynamic values
   instructions: "You are a helpful shopping assistant. Be friendly and personalized. Always refer to customers by name when you know it."

start_agent topic_selector:
   description: "Welcome customers and begin personalized shopping assistance"
   
   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         start_shopping: @utils.transition to @topic.shopping_assistant
            description: "Begin the personalized shopping session"

topic shopping_assistant:
   description: "Helps customers shop and manages their cart"

   actions:
      add_to_cart:
         description: "Adds an item to the customer's shopping cart"
         inputs:
            item_name: string
               description: "Name of the product item to add to the cart"
            price: object
               description: "Price of the item being added to the cart"
               complex_data_type_name: "lightning__currencyType"
         outputs:
            success: boolean
               description: "Indicates whether the item was added to the cart successfully"
            new_total: object
               description: "Updated cart total after adding the item"
               complex_data_type_name: "lightning__currencyType"
         target: "flow://AddToCart"

      get_recommendations:
         description: "Get personalized product recommendations"
         inputs:
            budget: object
               description: "Customer's budget to tailor recommendations within their price range"
               complex_data_type_name: "lightning__currencyType"
            preferences: string
               description: "Customer preferences or interests to personalize recommendations"
         outputs:
            recommendations: list[object]
               description: "List of personalized product recommendations matching budget and preferences"
               complex_data_type_name: "lightning__textType"
         target: "flow://GetRecommendations"

   reasoning:
      # Template expressions: {!expression} inserts dynamic values
      # You can use variables, conditionals, and simple logic
      instructions:->
         | 
         
         if @variables.customer_name:
            | You're helping {!@variables.customer_name}. Use their name ({!@variables.customer_name}) when speaking to make it personal!
         else:
            | You're helping a new customer. Ask for their name to personalize the experience.

         | Current shopping session:
         
         if @variables.budget > 0:
            | - Budget: ${!@variables.budget}
         else:
            | - Budget: Not set
         
         if @variables.cart_items:
            | - Cart items: {!@variables.cart_items}
         else:
            | - Cart items: Empty
         
         | - Cart total: ${!@variables.cart_total}
           - Loyalty points: {!@variables.loyalty_points}
         
         if (@variables.cart_total > @variables.budget) and (@variables.budget > 0):
            | - ⚠️ Cart total exceeds budget by ${!@variables.cart_total - @variables.budget}
  
         | Help the customer:
           1. Find recommendations that match their needs and budget using @actions.get_recommendations
           2. Add items to their cart when user confirms using @actions.add_to_cart
           3. Keep them informed of their cart total

      actions:
         add_to_cart: @actions.add_to_cart
            with item_name=...
            with price=...
            set @variables.cart_total = @outputs.new_total

         get_recommendations: @actions.get_recommendations
            with budget=@variables.budget
            with preferences=...
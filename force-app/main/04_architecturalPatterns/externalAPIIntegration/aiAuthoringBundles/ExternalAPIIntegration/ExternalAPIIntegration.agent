system:
   messages:
      welcome: "I can integrate with external APIs for weather, payments, and shipping!"
      error: "I encountered an issue integrating with external APIs. Please try again or contact support."
   instructions: "You integrate with external systems and handle API responses gracefully."

config:
    agent_name: "ExternalAPIIntegration"
    agent_label: "ExternalAPIIntegration"
    agent_type: "AgentforceEmployeeAgent"
    description: "Demonstrates integration with external systems using flows and Apex"

variables:
   # API request tracking
   api_request_id: mutable string = ""
      description: "The ID of the current API request."
   api_response_status: mutable boolean = False
      description: "The status of the API response (e.g., true for success, false for failure)."
   api_error_message: mutable string = ""
      description: "Error message returned by the API, if any."

   # Weather API example
   temperature: mutable number = 0
      description: "The current temperature fetched from the weather API."
   humidity: mutable number = 0
      description: "The current humidity percentage fetched from the weather API."
   conditions: mutable string = ""
      description: "The current weather conditions (e.g., Sunny, Cloudy)."

   # Payment API example
   transaction_id: mutable string = ""
      description: "The unique transaction ID returned after a payment."

   # Shipping API example
   shipment_status: mutable object = {}
      description: "The status object of the shipment tracking."

start_agent topic_selector:
   description: "Welcome users and begin external API integration services"
   
   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         begin_integration: @utils.transition to @topic.api_integration
            description: "Start external API integration services"

topic api_integration:
   description: "Demonstrates external API integrations"

   reasoning:
      instructions:->
         | Identify the action based on the users request. You can get weather, process payment or help with shipment.
         
         | If an action needs user input, prompt the user requesting the needed info before you perform the action. 
           For example for fetching weather you will need city name before you can proceed. 
           For making payment you need amount and payment token and for tracking shipping you need a tracking number.

         | When reporting weather, use the data in {!@variables.temperature}, {!@variables.humidity}, and {!@variables.conditions}.
           When a payment is processed, confirm with the {!@variables.transaction_id}.
           When tracking a shipment, provide the status from {!@variables.shipment_status}.
           
           If an API error occurs (checked via {!@variables.api_error_message}), apologize and show the error.

      actions:
         # Weather API integration
         fetch_weather: @actions.get_weather
            with cityName= ...
            set @variables.temperature = @outputs.temperature
            set @variables.humidity = @outputs.humidity
            set @variables.conditions = @outputs.conditions
            set @variables.api_response_status = @outputs.success
            set @variables.api_error_message = @outputs.error_message

         # Payment API integration
         make_payment: @actions.process_payment
            with amount=...
            with paymentToken=...
            with currencyName="USD"
            set @variables.transaction_id = @outputs.transactionId
            set @variables.api_response_status = @outputs.success
            set @variables.api_error_message = @outputs.errorMessage

         # Shipping API integration
         check_tracking: @actions.track_shipment
            with tracking_number=...
            with carrier="USPS"
            set @variables.shipment_status = @outputs.status
            set @variables.api_response_status = @outputs.success

   actions:
      get_weather:
         description: "Fetch weather data from external API via Flow"
         inputs:
            cityName: string
         outputs:
            temperature: number
            conditions: string
            humidity: number
            success: boolean
            error_message: string
         target: "apex://WeatherService"

      # Apex-based API integration

      process_payment:
         description: "Process payment via external payment gateway using Apex"
         inputs:
            amount: number
            paymentToken: string
            currencyName: string
         outputs:
            transactionId: string
            status: string
            success: boolean
            errorMessage: string
         target: "apex://PaymentGatewayController"
         
      # Flow-based tracking

      track_shipment:
         description: "Track shipment via external shipping API"
         inputs:
            tracking_number: string
            carrier: string
         outputs:
            status: object
            estimated_delivery: string
            success: boolean
         target: "flow://TrackShipment"

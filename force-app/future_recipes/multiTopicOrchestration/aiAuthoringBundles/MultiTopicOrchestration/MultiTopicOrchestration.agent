# MultiTopicOrchestration - Complex Multi-Service Coordination
# Demonstrates coordinating multiple specialized topics in complex workflows with an orchestrator pattern

config:
   agent_name: "MultiTopicOrchestration"
   agent_label: "MultiTopicOrchestration"
   agent_type: "AgentforceEmployeeAgent"
   description: "Demonstrates complex multi-topic orchestration with specialized topics"


# State for travel booking workflow
variables:
   # User info
   traveler_name: mutable string = ""
      description: "The full name of the traveler"
   traveler_email: mutable string = ""
      description: "The email address where the itinerary will be sent"

   # Flight booking
   departure_city: mutable string = ""
      description: "The city the flight departs from"
   destination_city: mutable string = ""
      description: "The destination city for the flight"
   travel_date: mutable string = ""
      description: "The date of the flight in YYYY-MM-DD format"
   flight_booked: mutable boolean = False
      description: "True if a flight has been successfully booked"
   flight_confirmation: mutable string = ""
      description: "Confirmation number for the booked flight"

   # Hotel booking
   hotel_city: mutable string = ""
      description: "The city where the hotel is located"
   checkin_date: mutable string = ""
      description: "Hotel check-in date in YYYY-MM-DD format"
   checkout_date: mutable string = ""
      description: "Hotel check-out date in YYYY-MM-DD format"
   hotel_booked: mutable boolean = False
      description: "True if a hotel has been successfully booked"
   hotel_confirmation: mutable string = ""
      description: "Confirmation number for the booked hotel"

   # Car rental
   rental_city: mutable string = ""
      description: "The city where the car rental will be picked up"
   rental_start: mutable string = ""
      description: "Car rental start date in YYYY-MM-DD format"
   rental_end: mutable string = ""
      description: "Car rental end date in YYYY-MM-DD format"
   car_booked: mutable boolean = False
      description: "True if a car has been successfully booked"
   car_confirmation: mutable string = ""
      description: "Confirmation number for the booked car"

   # Overall status
   booking_complete: mutable boolean = False
      description: "True if the entire itinerary has been finalized and sent"

system:
   messages:
      welcome: "Welcome to Travel Booking! I'll help you book flights, hotels, and car rentals."
      error: "I encountered an issue with your booking. Please try again."

   instructions: "You are a travel booking assistant that orchestrates complex multi-service bookings."

start_agent topic_selector:
   description: "Welcome travelers and coordinate their travel booking needs for flights, hotels, and car rentals"
   
   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         start_booking: @utils.transition to @topic.orchestrator

# TOPIC 1: Orchestrator - Main entry point and coordination
topic orchestrator:
   description: "Main orchestrator for travel booking workflow"

   actions:
      book_flight:
         description: "Book a flight"
         inputs:
            departure: string
               description: "Departure city or airport code"
            destination: string
               description: "Destination city or airport code"
            travel_date: string
               description: "Flight date in ISO format (YYYY-MM-DD)"
            traveler: string
               description: "Name of the traveler for the flight booking"
         outputs:
            confirmation_number: string
               description: "Flight booking confirmation number"
            success: boolean
               description: "Indicates whether the flight was booked successfully"
         target: "flow://BookFlight"

      book_hotel:
         description: "Book a hotel"
         inputs:
            city: string
               description: "City where the hotel is located"
            checkin: string
               description: "Hotel check-in date in ISO format (YYYY-MM-DD)"
            checkout: string
               description: "Hotel check-out date in ISO format (YYYY-MM-DD)"
            guest_name: string
               description: "Name of the guest for the hotel reservation"
         outputs:
            confirmation_number: string
               description: "Hotel booking confirmation number"
            success: boolean
               description: "Indicates whether the hotel was booked successfully"
         target: "flow://BookHotel"

      book_car:
         description: "Book a rental car"
         inputs:
            city: string
               description: "City where the rental car will be picked up"
            start_date: string
               description: "Car rental start date in ISO format (YYYY-MM-DD)"
            end_date: string
               description: "Car rental end date in ISO format (YYYY-MM-DD)"
            renter_name: string
               description: "Name of the person renting the car"
         outputs:
            confirmation_number: string
               description: "Car rental confirmation number"
            success: boolean
               description: "Indicates whether the car was booked successfully"
         target: "flow://BookCar"

      send_itinerary:
         description: "Send complete itinerary email"
         inputs:
            email: string
               description: "Email address to send the complete travel itinerary to"
            flight_conf: string
               description: "Flight booking confirmation number to include in itinerary"
            hotel_conf: string
               description: "Hotel booking confirmation number to include in itinerary"
            car_conf: string
               description: "Car rental confirmation number to include in itinerary"
         outputs:
            sent: boolean
               description: "Indicates whether the itinerary email was sent successfully"
         target: "flow://SendItinerary"

   reasoning:
      instructions:->
         | Welcome to Travel Booking! I can help you book:
           1. Flights âœˆï¸ (Use {!@actions.start_flight_booking})
           2. Hotels ðŸ¨ (Use {!@actions.start_hotel_booking})
           3. Car Rentals ðŸš— (Use {!@actions.start_car_booking})
          
           Current Status:
           - Flight: {!@variables.flight_booked}
           - Hotel: {!@variables.hotel_booked}
           - Car: {!@variables.car_booked}
          
           If everything is booked, I can {!@actions.complete_booking}.
           
           Call the action that best matches the user's request.

      actions:
         # Transition to flight booking
         start_flight_booking: @utils.transition to @topic.flight_booking  

         # Transition to hotel booking
         start_hotel_booking: @utils.transition to @topic.hotel_booking

         # Transition to car booking
         start_car_booking: @utils.transition to @topic.car_booking

         # Complete booking and send itinerary
         complete_booking: @actions.send_itinerary
            with email=@variables.traveler_email
            with flight_conf=@variables.flight_confirmation
            with hotel_conf=@variables.hotel_confirmation
            with car_conf=@variables.car_confirmation
            set @variables.booking_complete = @outputs.sent

# TOPIC 2: Flight Booking - Specialized for flights
topic flight_booking:
   description: "Handles flight booking workflow"

   actions:
      book_flight:
         description: "Book a flight"
         inputs:
            departure: string
               description: "Departure city or airport code"
            destination: string
               description: "Destination city or airport code"
            travel_date: string
               description: "Flight date in ISO format (YYYY-MM-DD)"
            traveler: string
               description: "Name of the traveler for the flight booking"
         outputs:
            confirmation_number: string
               description: "Flight booking confirmation number"
            success: boolean
               description: "Indicates whether the flight was booked successfully"
         target: "flow://BookFlight"

   reasoning:
      instructions:->
         | Let's book your flight! âœˆï¸
          
         if not @variables.traveler_name:
            | First, what's your name?
         if @variables.traveler_name and not @variables.departure_city:
            | Great! What city are you departing from?
         if @variables.departure_city and not @variables.destination_city:
            | Where are you flying to?
         if @variables.destination_city and not @variables.travel_date:
            | What date would you like to travel?
         if @variables.travel_date:
            | Perfect! Let me book your flight using {!@actions.book_flight_action}.

      actions:
         book_flight_action: @actions.book_flight
            with departure=...
            with destination=...
            with travel_date=...
            with traveler=...
            set @variables.flight_confirmation = @outputs.confirmation_number
            set @variables.flight_booked = @outputs.success
            # Return to orchestrator after booking
            transition to @topic.orchestrator

# TOPIC 3: Hotel Booking - Specialized for hotels
topic hotel_booking:
   description: "Handles hotel booking workflow"

   actions:
      book_hotel:
         description: "Book a hotel"
         inputs:
            city: string
               description: "City where the hotel is located"
            checkin: string
               description: "Hotel check-in date in ISO format (YYYY-MM-DD)"
            checkout: string
               description: "Hotel check-out date in ISO format (YYYY-MM-DD)"
            guest_name: string
               description: "Name of the guest for the hotel reservation"
         outputs:
            confirmation_number: string
               description: "Hotel booking confirmation number"
            success: boolean
               description: "Indicates whether the hotel was booked successfully"
         target: "flow://BookHotel"

   reasoning:
      instructions:->
         | Let's book your hotel! ðŸ¨
          
         if not @variables.hotel_city:
            | Which city do you need a hotel in?
         if @variables.hotel_city and not @variables.checkin_date:
            | What's your check-in date?
         if @variables.checkin_date and not @variables.checkout_date:
            | What's your check-out date?
         if @variables.checkout_date:
            | Perfect! Let me book your hotel using {!@actions.book_hotel_action}.

      actions:
         book_hotel_action: @actions.book_hotel
            with city=...
            with checkin=...
            with checkout=...
            with guest_name=...
            set @variables.hotel_confirmation = @outputs.confirmation_number
            set @variables.hotel_booked = @outputs.success
            # Return to orchestrator
            transition to @topic.orchestrator

# TOPIC 4: Car Rental - Specialized for car rentals
topic car_booking:
   description: "Handles car rental booking workflow"

   actions:
      book_car:
         description: "Book a rental car"
         inputs:
            city: string
               description: "City where the rental car will be picked up"
            start_date: string
               description: "Car rental start date in ISO format (YYYY-MM-DD)"
            end_date: string
               description: "Car rental end date in ISO format (YYYY-MM-DD)"
            renter_name: string
               description: "Name of the person renting the car"
         outputs:
            confirmation_number: string
               description: "Car rental confirmation number"
            success: boolean
               description: "Indicates whether the car was booked successfully"
         target: "flow://BookCar"

   reasoning:
      instructions:->
         | Let's book your rental car! ðŸš—
          
         if not @variables.rental_city:
            | Which city do you need a rental car in?
         if @variables.rental_city and not @variables.rental_start:
            | What's your pickup date?
         if @variables.rental_start and not @variables.rental_end:
            | What's your return date?
         if @variables.rental_end:
            | Perfect! Let me book your car using {!@actions.book_car_action}.

      actions:
         book_car_action: @actions.book_car
            with city=...
            with start_date=...
            with end_date=...
            with renter_name=...
            set @variables.car_confirmation = @outputs.confirmation_number
            set @variables.car_booked = @outputs.success
            # Return to orchestrator
            transition to @topic.orchestrator
